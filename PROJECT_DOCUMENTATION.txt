Hot's POD 프로젝트 전체 문서
AI 기반 오프라인 소모임 플랫폼

목차:
1. SQL 쿼리문 전체 목록
2. 프로젝트 요구사항 및 기능 명세
3. 데이터베이스 설계 및 테이블 구성

1. SQL 쿼리문 전체 목록

1.1. DDL (Data Definition Language) 데이터베이스 스키마

/* 데이터베이스 생성 */
CREATE DATABASE IF NOT EXISTS `hots_pod_db` CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;
USE `hots_pod_db`;

/* 기존 객체 삭제 */
DROP TABLE IF EXISTS `VectorSyncQueue`;
DROP TABLE IF EXISTS `Log`;
DROP TABLE IF EXISTS `Chat`;
DROP TABLE IF EXISTS `Comment`;
DROP TABLE IF EXISTS `Pod_Member`;
DROP TABLE IF EXISTS `CategoryLink`;
DROP TABLE IF EXISTS `Pod`;
DROP TABLE IF EXISTS `Category`;
DROP TABLE IF EXISTS `KakaoAPI`;
DROP TABLE IF EXISTS `User`;

DROP TRIGGER IF EXISTS `trg_pod_after_insert`;
DROP TRIGGER IF EXISTS `trg_pod_after_update`;
DROP TRIGGER IF EXISTS `trg_pod_after_delete`;

DROP PROCEDURE IF EXISTS `sp_CreatePod`;
DROP PROCEDURE IF EXISTS `sp_GetPodDetailsForVectorizing`;
DROP PROCEDURE IF EXISTS `sp_FilterPods`;
DROP PROCEDURE IF EXISTS `sp_GetAllCategories`;

/* 테이블 생성 */

-- 사용자 테이블
CREATE TABLE `User` (
  `user_id` INT NOT NULL AUTO_INCREMENT,
  `username` VARCHAR(100) NOT NULL,
  `phonenumber` VARCHAR(20) NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`user_id`),
  INDEX `IDX_User_username` (`username`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 카카오 API 연동 테이블
CREATE TABLE `KakaoAPI` (
  `k_id` BIGINT NOT NULL,
  `user_id` INT NOT NULL,
  `access_token` VARCHAR(255) NULL,
  `refresh_token` VARCHAR(255) NULL,
  `user_name` VARCHAR(100) NULL,
  `profile_picture` VARCHAR(255) NULL,
  PRIMARY KEY (`k_id`),
  UNIQUE KEY `UK_KakaoAPI_user_id` (`user_id`),
  CONSTRAINT `FK_User_TO_KakaoAPI` FOREIGN KEY (`user_id`) REFERENCES `User` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 카테고리 테이블 (계층 구조)
CREATE TABLE `Category` (
  `category_id` INT NOT NULL AUTO_INCREMENT,
  `category_name` VARCHAR(100) NOT NULL,
  `parent_category_id` INT NULL,
  PRIMARY KEY (`category_id`),
  INDEX `IDX_Category_name` (`category_name`),
  CONSTRAINT `FK_Category_TO_Category` FOREIGN KEY (`parent_category_id`) REFERENCES `Category` (`category_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 소모임(Pod) 테이블
CREATE TABLE `Pod` (
  `pod_id` INT NOT NULL AUTO_INCREMENT,
  `host_user_id` INT NOT NULL,
  `event_time` DATETIME NOT NULL,
  `place` VARCHAR(255) NOT NULL,
  `title` VARCHAR(255) NOT NULL,
  `content` TEXT NULL,
  `min_peoples` INT NOT NULL,
  `max_peoples` INT NOT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`pod_id`),
  INDEX `IDX_Pod_event_time` (`event_time`),
  INDEX `IDX_Pod_place` (`place`),
  CONSTRAINT `FK_User_TO_Pod` FOREIGN KEY (`host_user_id`) REFERENCES `User` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Pod-Category 연결 테이블
CREATE TABLE `CategoryLink` (
  `category_link_id` INT NOT NULL AUTO_INCREMENT,
  `pod_id` INT NOT NULL,
  `category_id` INT NOT NULL,
  PRIMARY KEY (`category_link_id`),
  UNIQUE KEY `UK_CategoryLink_pod_category` (`pod_id`, `category_id`),
  CONSTRAINT `FK_Pod_TO_CategoryLink` FOREIGN KEY (`pod_id`) REFERENCES `Pod` (`pod_id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Category_TO_CategoryLink` FOREIGN KEY (`category_id`) REFERENCES `Category` (`category_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- Pod 참가자 테이블
CREATE TABLE `Pod_Member` (
  `pod_member_id` INT NOT NULL AUTO_INCREMENT,
  `user_id` INT NOT NULL,
  `pod_id` INT NOT NULL,
  `amount` INT NULL DEFAULT 0,
  `place_start` VARCHAR(255) NULL,
  `place_end` VARCHAR(255) NULL,
  `joined_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`pod_member_id`),
  UNIQUE KEY `UK_Pod_Member_user_pod` (`user_id`, `pod_id`),
  CONSTRAINT `FK_User_TO_Pod_Member` FOREIGN KEY (`user_id`) REFERENCES `User` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Pod_TO_Pod_Member` FOREIGN KEY (`pod_id`) REFERENCES `Pod` (`pod_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 댓글 테이블 (계층 구조)
CREATE TABLE `Comment` (
  `comment_id` INT NOT NULL AUTO_INCREMENT,
  `pod_id` INT NOT NULL,
  `user_id` INT NOT NULL,
  `content` TEXT NOT NULL,
  `parent_comment_id` INT NULL,
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`comment_id`),
  INDEX `IDX_Comment_pod` (`pod_id`),
  CONSTRAINT `FK_Pod_TO_Comment` FOREIGN KEY (`pod_id`) REFERENCES `Pod` (`pod_id`) ON DELETE CASCADE,
  CONSTRAINT `FK_User_TO_Comment` FOREIGN KEY (`user_id`) REFERENCES `User` (`user_id`) ON DELETE CASCADE,
  CONSTRAINT `FK_Comment_TO_Comment` FOREIGN KEY (`parent_comment_id`) REFERENCES `Comment` (`comment_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 실시간 채팅 테이블
CREATE TABLE `Chat` (
  `chat_id` BIGINT NOT NULL AUTO_INCREMENT,
  `pod_id` INT NOT NULL,
  `user_id` INT NOT NULL,
  `content` TEXT NULL,
  `time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`chat_id`),
  INDEX `IDX_Chat_pod_time` (`pod_id`, `time`),
  CONSTRAINT `FK_Pod_TO_Chat` FOREIGN KEY (`pod_id`) REFERENCES `Pod` (`pod_id`) ON DELETE CASCADE,
  CONSTRAINT `FK_User_TO_Chat` FOREIGN KEY (`user_id`) REFERENCES `User` (`user_id`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 로그 테이블
CREATE TABLE `Log` (
  `log_id` BIGINT NOT NULL AUTO_INCREMENT,
  `user_id` INT NULL,
  `log_code` VARCHAR(50) NULL,
  `time` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `content` TEXT NULL,
  PRIMARY KEY (`log_id`),
  INDEX `IDX_Log_time` (`time`),
  CONSTRAINT `FK_User_TO_Log` FOREIGN KEY (`user_id`) REFERENCES `User` (`user_id`) ON DELETE SET NULL
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

-- 벡터 동기화 큐 테이블 (RAG)
CREATE TABLE `VectorSyncQueue` (
  `queue_id` BIGINT NOT NULL AUTO_INCREMENT,
  `pod_id` INT NOT NULL,
  `action_type` ENUM('upsert', 'delete') NOT NULL,
  `status` ENUM('pending', 'processing', 'failed') NOT NULL DEFAULT 'pending',
  `created_at` TIMESTAMP NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `retry_count` INT NOT NULL DEFAULT 0,
  PRIMARY KEY (`queue_id`),
  INDEX `IDX_VectorSyncQueue_status_created` (`status`, `created_at`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_unicode_ci;

1.2. 트리거 (Triggers)

-- Pod 생성 시 벡터화 큐 추가
DELIMITER $$
CREATE TRIGGER `trg_pod_after_insert`
AFTER INSERT ON `Pod`
FOR EACH ROW
BEGIN
    INSERT INTO `VectorSyncQueue` (`pod_id`, `action_type`, `status`, `created_at`)
    VALUES (NEW.`pod_id`, 'upsert', 'pending', CURRENT_TIMESTAMP);
END$$
DELIMITER ;

-- Pod 수정 시 벡터 재생성
DELIMITER $$
CREATE TRIGGER `trg_pod_after_update`
AFTER UPDATE ON `Pod`
FOR EACH ROW
BEGIN
    IF NOT (OLD.`title` <=> NEW.`title`) OR
       NOT (OLD.`content` <=> NEW.`content`) OR
       NOT (OLD.`place` <=> NEW.`place`) THEN
        INSERT INTO `VectorSyncQueue` (`pod_id`, `action_type`, `status`, `created_at`)
        VALUES (NEW.`pod_id`, 'upsert', 'pending', CURRENT_TIMESTAMP);
    END IF;
END$$
DELIMITER ;

-- Pod 삭제 시 벡터 삭제
DELIMITER $$
CREATE TRIGGER `trg_pod_after_delete`
AFTER DELETE ON `Pod`
FOR EACH ROW
BEGIN
    INSERT INTO `VectorSyncQueue` (`pod_id`, `action_type`, `status`, `created_at`)
    VALUES (OLD.`pod_id`, 'delete', 'pending', CURRENT_TIMESTAMP);
END$$
DELIMITER ;

1.3. 저장 프로시저 (Stored Procedures)

-- Pod 생성 (트랜잭션)
DELIMITER $$
CREATE PROCEDURE `sp_CreatePod`(
    IN `in_host_user_id` INT,
    IN `in_event_time` DATETIME,
    IN `in_place` VARCHAR(255),
    IN `in_title` VARCHAR(255),
    IN `in_content` TEXT,
    IN `in_min_peoples` INT,
    IN `in_max_peoples` INT,
    IN `in_category_ids` JSON
)
BEGIN
    DECLARE `new_pod_id` INT;
    DECLARE `_category_id` INT;
    DECLARE `_index` INT DEFAULT 1;
    DECLARE `_length` INT;

    START TRANSACTION;

    INSERT INTO `Pod` (`host_user_id`, `event_time`, `place`, `title`, `content`, `min_peoples`, `max_peoples`)
    VALUES (`in_host_user_id`, `in_event_time`, `in_place`, `in_title`, `in_content`, `in_min_peoples`, `in_max_peoples`);

    SET `new_pod_id` = LAST_INSERT_ID();
    SET `_length` = JSON_LENGTH(`in_category_ids`);

    WHILE `_index` < `_length` DO
        SET `_category_id` = JSON_UNQUOTE(JSON_EXTRACT(`in_category_ids`, CONCAT('$[', `_index`, ']')));
        
        INSERT INTO `CategoryLink` (`pod_id`, `category_id`)
        VALUES (`new_pod_id`, `_category_id`);
        
        SET `_index` = `_index` + 1;
    END WHILE;

    COMMIT;

    SELECT `new_pod_id` AS `pod_id`;
END$$
DELIMITER ;

-- Pod 벡터화용 상세 정보 조회
DELIMITER $$
CREATE PROCEDURE `sp_GetPodDetailsForVectorizing`(
    IN `in_pod_id` INT
)
BEGIN
    SELECT 
        p.`pod_id`,
        p.`title`,
        p.`content`,
        p.`place`,
        p.`event_time`,
        p.`min_peoples`,
        p.`max_peoples`,
        (SELECT GROUP_CONCAT(c.`category_name` SEPARATOR ', ')
         FROM `CategoryLink` cl
         JOIN `Category` c ON cl.`category_id` = c.`category_id`
         WHERE cl.`pod_id` = p.`pod_id`) AS `categories`
    FROM `Pod` p
    WHERE p.`pod_id` = `in_pod_id`;
END$$
DELIMITER ;

-- Pod 필터링 검색
DELIMITER $$
CREATE PROCEDURE `sp_FilterPods`(
    IN `in_pod_ids_json` JSON,
    IN `in_place_keyword` VARCHAR(255),
    IN `in_category_id` INT
)
BEGIN
    SELECT 
        p.`pod_id`,
        p.`host_user_id`,
        p.`event_time`,
        p.`place`,
        p.`title`,
        p.`content`,
        p.`min_peoples`,
        p.`max_peoples`,
        p.`created_at`,
        p.`updated_at`,
        u.`username` AS `host_username`
    FROM `Pod` p
    JOIN `User` u ON p.`host_user_id` = u.`user_id`
    WHERE p.`pod_id` IN (
        SELECT CAST(`pod_id_str` AS UNSIGNED) 
        FROM JSON_TABLE(
            `in_pod_ids_json`,
            "$[*]" COLUMNS (`pod_id_str` VARCHAR(20) PATH "$")
        ) AS `jt`
    )
    AND (`in_place_keyword` IS NULL OR p.`place` COLLATE utf8mb4_unicode_ci LIKE CONCAT('%', `in_place_keyword` COLLATE utf8mb4_unicode_ci, '%'))
    AND (`in_category_id` IS NULL OR EXISTS (
        SELECT 1 FROM `CategoryLink` cl
        WHERE cl.`pod_id` = p.`pod_id` AND cl.`category_id` = `in_category_id`
    ))
    AND p.`event_time` > NOW()
    ORDER BY p.`event_time` DESC
    LIMIT 10;
END$$
DELIMITER ;

-- 모든 카테고리 조회
DELIMITER $$
CREATE PROCEDURE `sp_GetAllCategories`()
BEGIN
    SELECT `category_id`, `category_name`, `parent_category_id`
    FROM `Category`
    ORDER BY `category_name`;
END$$
DELIMITER ;

1.4. DML (Data Manipulation Language) 주요 쿼리문

/* User 관련 쿼리 */
-- 사용자 생성
INSERT INTO User (username, phonenumber) VALUES (%s, %s);

-- 사용자 조회
SELECT * FROM User WHERE user_id = %s;

-- 사용자 프로필 사진 조회
SELECT profile_picture FROM kakaoapi WHERE user_id = %s;

/* Pod 관련 쿼리 */
-- Pod 상세 조회 (호스트 정보 포함)
SELECT p.*, u.username AS host_username
FROM Pod p
JOIN User u ON p.host_user_id = u.user_id
WHERE p.pod_id = %s;

-- Pod 목록 조회 (페이징)
SELECT
    p.pod_id,
    p.host_user_id,
    p.event_time,
    p.place,
    p.title,
    p.content,
    p.min_peoples,
    p.max_peoples,
    p.created_at,
    p.updated_at,
    u.username AS host_username,
    COALESCE(pm_count.current_member, 0) AS current_member,
    COALESCE(cat_agg.category_ids, JSON_ARRAY()) AS category_ids
FROM Pod p
JOIN User u ON p.host_user_id = u.user_id
LEFT JOIN (
    SELECT pod_id, COUNT(*) AS current_member
    FROM Pod_Member
    GROUP BY pod_id
) pm_count ON p.pod_id = pm_count.pod_id
LEFT JOIN (
    SELECT pod_id, JSON_ARRAYAGG(category_id) AS category_ids
    FROM CategoryLink
    GROUP BY pod_id
) cat_agg ON p.pod_id = cat_agg.pod_id
ORDER BY p.created_at DESC
LIMIT %s OFFSET %s;

-- Pod 생성 (저장 프로시저 호출)
CALL sp_CreatePod(%s, %s, %s, %s, %s, %s, %s, %s);

-- Pod 참가자 추가
INSERT INTO Pod_Member (user_id, pod_id) VALUES (%s, %s);

/* Pod_Member 관련 쿼리 */
-- Pod 멤버 조회
SELECT pm.*, u.username, u.phonenumber
FROM Pod_Member pm
JOIN User u ON pm.user_id = u.user_id
WHERE pm.pod_id = %s
ORDER BY pm.joined_at ASC
LIMIT %s OFFSET %s;

-- 멤버 수 확인
SELECT COUNT(*) as count FROM Pod_Member WHERE pod_id = %s;

-- 참가 여부 확인
SELECT 1 FROM Pod_Member WHERE pod_id = %s AND user_id = %s;

-- Pod 탈퇴
DELETE FROM Pod_Member WHERE pod_id = %s AND user_id = %s;

-- 멤버 정보 수정
UPDATE Pod_Member SET amount = %s, place_start = %s, place_end = %s 
WHERE pod_id = %s AND user_id = %s;

/* Comment 관련 쿼리 */
-- 댓글 생성
INSERT INTO Comment (pod_id, user_id, content, parent_comment_id)
VALUES (%s, %s, %s, %s);

-- Pod 댓글 조회 (최상위 댓글)
SELECT c.*, u.username
FROM Comment c
JOIN User u ON c.user_id = u.user_id
WHERE c.pod_id = %s AND c.parent_comment_id IS NULL
ORDER BY c.created_at ASC;

-- 대댓글 조회
SELECT c.*, u.username
FROM Comment c
JOIN User u ON c.user_id = u.user_id
WHERE c.parent_comment_id = %s
ORDER BY c.created_at ASC;

-- 댓글 삭제
DELETE FROM Comment WHERE comment_id = %s;

/* Chat 관련 쿼리 */
-- 채팅 메시지 조회 (페이징)
SELECT c.*, u.username
FROM Chat c
JOIN User u ON c.user_id = u.user_id
WHERE c.pod_id = %s
ORDER BY c.time DESC
LIMIT %s OFFSET %s;

-- 채팅 메시지 생성
INSERT INTO Chat (pod_id, user_id, content)
VALUES (%s, %s, %s);

/* OAuth 관련 쿼리 */
-- 카카오 사용자 정보 조회
SELECT 
    u.user_id,
    u.username,
    u.phonenumber,
    u.created_at,
    k.profile_picture
FROM User u
LEFT JOIN KakaoAPI k ON u.user_id = k.user_id
WHERE k.k_id = %s;

-- 카카오 정보 저장/갱신
INSERT INTO KakaoAPI 
(k_id, user_id, access_token, refresh_token, user_name, profile_picture)
VALUES (%s, %s, %s, %s, %s, %s)
ON DUPLICATE KEY UPDATE
    access_token = VALUES(access_token),
    refresh_token = VALUES(refresh_token),
    user_name = VALUES(user_name),
    profile_picture = VALUES(profile_picture);

/* RAG (VectorSyncQueue) 관련 쿼리 */
-- 대기 중인 작업 가져오기 (락)
SELECT queue_id, pod_id, action_type 
FROM VectorSyncQueue 
WHERE status = 'pending' 
ORDER BY created_at ASC 
LIMIT %s 
FOR UPDATE SKIP LOCKED;

-- 작업 상태 변경
UPDATE VectorSyncQueue SET status = %s WHERE queue_id IN (...);

-- 작업 삭제
DELETE FROM VectorSyncQueue WHERE queue_id = %s;

-- 작업 실패 처리
UPDATE VectorSyncQueue SET status = %s, retry_count = retry_count + 1 WHERE queue_id = %s;

2. 프로젝트 요구사항 및 기능 명세

2.1. 프로젝트 개요
프로젝트명: Hot's POD
목적: AI 기반 자연어 검색으로 오프라인 소모임을 찾고 참여하는 플랫폼
핵심 기술: RAG (Retrieval-Augmented Generation), FastAPI, MariaDB, ChromaDB
버전: 3.0.0

2.2. 주요 기능 요구사항

[F-001] 사용자 관리
- 사용자 회원가입 (카카오 OAuth 2.0)
- 사용자 프로필 관리
- JWT 기반 인증/인가

[F-002] Pod(소모임) 관리
- Pod 생성/조회/수정/삭제
- 다중 카테고리 지정
- 참가자 모집 (최소/최대 인원 설정)
- 호스트 권한 관리

[F-003] AI 자연어 검색 (RAG)
- 사용자 질의 분석 (장소, 카테고리, 시간)
- 벡터 유사도 검색 (ChromaDB)
- RDB 정밀 필터링 (MariaDB)
- LLM 답변 생성

[F-004] 실시간 채팅
- Pod별 독립적인 채팅방
- WebSocket 기반 실시간 통신
- 메시지 영구 저장

[F-005] 댓글 시스템
- Pod에 대한 댓글/대댓글
- 계층 구조 지원
- 댓글 작성/조회/삭제

[F-006] 참가자 관리
- Pod 참가 신청/승인/거절
- 참가자 목록 조회
- 탈퇴 기능

[F-007] 자동 벡터화
- DB 트리거 기반 자동 큐 추가
- 백그라운드 워커 폴링
- 실시간 벡터 인덱싱

3. 데이터베이스 설계 및 테이블 구성

3.1. 데이터베이스 개요
데이터베이스명: hots_pod_db
문자셋: utf8mb4
콜레이션: utf8mb4_unicode_ci
엔진: InnoDB
총 테이블 수: 10개

3.2. ERD (Entity Relationship Diagram)

User (1) ────── (1) KakaoAPI
  │
  │ (1:N)
  │
  ├── Pod (host_user_id)
  │     │
  │     │ (1:N)
  │     ├── Pod_Member
  │     ├── Comment (자기 참조)
  │     ├── Chat
  │     └── CategoryLink ── Category (계층 구조)
  │
  ├── Pod_Member
  ├── Comment
  ├── Chat
  └── Log

VectorSyncQueue (독립)

3.3. 테이블 상세 설계

[TABLE] User 사용자
목적: 사용자 계정 관리
PK: user_id (INT, AUTO_INCREMENT)
컬럼:
  - user_id: 사용자 고유 ID
  - username: 사용자 이름 (VARCHAR 100, NOT NULL)
  - phonenumber: 전화번호 (VARCHAR 20, NULL)
  - created_at: 생성 시각 (TIMESTAMP, DEFAULT CURRENT_TIMESTAMP)
인덱스:
  - IDX_User_username (username)
관계:
  - 1:1 → KakaoAPI
  - 1:N → Pod (host_user_id)
  - 1:N → Pod_Member
  - 1:N → Comment
  - 1:N → Chat
  - 1:N → Log
비고: 카카오 로그인 시 자동 생성

[TABLE] KakaoAPI 카카오 OAuth 정보
목적: 카카오 API 연동 정보 저장
PK: k_id (BIGINT, 카카오 고유 ID)
컬럼:
  - k_id: 카카오 고유 ID
  - user_id: User 외래키 (INT, NOT NULL, UNIQUE)
  - access_token: 액세스 토큰 (VARCHAR 255)
  - refresh_token: 리프레시 토큰 (VARCHAR 255)
  - user_name: 카카오 닉네임 (VARCHAR 100)
  - profile_picture: 프로필 사진 URL (VARCHAR 255)
인덱스:
  - UK_KakaoAPI_user_id (UNIQUE)
관계:
  - N:1 → User (user_id)
비고: ON DUPLICATE KEY UPDATE로 갱신

[TABLE] Category 카테고리
목적: 소모임 카테고리 관리 (계층 구조)
PK: category_id (INT, AUTO_INCREMENT)
컬럼:
  - category_id: 카테고리 ID
  - category_name: 카테고리명 (VARCHAR 100, NOT NULL)
  - parent_category_id: 부모 카테고리 ID (INT, NULL)
인덱스:
  - IDX_Category_name (category_name)
관계:
  - 자기 참조 (parent_category_id)
  - 1:N → CategoryLink
비고: 
  - 최상위: parent_category_id = NULL
  - 예시: 스포츠 > 축구, 러닝

[TABLE] Pod 소모임
목적: 오프라인 소모임 정보 관리
PK: pod_id (INT, AUTO_INCREMENT)
컬럼:
  - pod_id: Pod 고유 ID
  - host_user_id: 호스트 User ID (INT, NOT NULL)
  - event_time: 이벤트 시간 (DATETIME, NOT NULL)
  - place: 장소 (VARCHAR 255, NOT NULL)
  - title: 제목 (VARCHAR 255, NOT NULL)
  - content: 내용 (TEXT)
  - min_peoples: 최소 인원 (INT, NOT NULL)
  - max_peoples: 최대 인원 (INT, NOT NULL)
  - created_at: 생성 시각 (TIMESTAMP)
  - updated_at: 수정 시각 (TIMESTAMP, ON UPDATE)
인덱스:
  - IDX_Pod_event_time (event_time)
  - IDX_Pod_place (place)
관계:
  - N:1 → User (host_user_id)
  - 1:N → Pod_Member
  - 1:N → CategoryLink
  - 1:N → Comment
  - 1:N → Chat
트리거:
  - INSERT → VectorSyncQueue 추가 (upsert)
  - UPDATE → VectorSyncQueue 추가 (upsert, 조건부)
  - DELETE → VectorSyncQueue 추가 (delete)

[TABLE] CategoryLink Pod-Category 연결
목적: Pod와 Category의 다대다 관계
PK: category_link_id (INT, AUTO_INCREMENT)
컬럼:
  - category_link_id: 연결 ID
  - pod_id: Pod 외래키 (INT, NOT NULL)
  - category_id: Category 외래키 (INT, NOT NULL)
인덱스:
  - UK_CategoryLink_pod_category (pod_id, category_id, UNIQUE)
관계:
  - N:1 → Pod
  - N:1 → Category
비고: 한 Pod는 여러 카테고리 가능

[TABLE] Pod_Member Pod 참가자
목적: Pod 참가자 정보 관리
PK: pod_member_id (INT, AUTO_INCREMENT)
컬럼:
  - pod_member_id: 멤버 ID
  - user_id: User 외래키 (INT, NOT NULL)
  - pod_id: Pod 외래키 (INT, NOT NULL)
  - amount: 비용 (INT, DEFAULT 0)
  - place_start: 출발지 (VARCHAR 255)
  - place_end: 도착지 (VARCHAR 255)
  - joined_at: 참가 시각 (TIMESTAMP)
인덱스:
  - UK_Pod_Member_user_pod (user_id, pod_id, UNIQUE)
관계:
  - N:1 → User
  - N:1 → Pod
비고: 중복 참가 방지 (UNIQUE KEY)

[TABLE] Comment 댓글
목적: Pod 댓글 관리 (계층 구조)
PK: comment_id (INT, AUTO_INCREMENT)
컬럼:
  - comment_id: 댓글 ID
  - pod_id: Pod 외래키 (INT, NOT NULL)
  - user_id: User 외래키 (INT, NOT NULL)
  - content: 내용 (TEXT, NOT NULL)
  - parent_comment_id: 부모 댓글 ID (INT, NULL)
  - created_at: 생성 시각 (TIMESTAMP)
인덱스:
  - IDX_Comment_pod (pod_id)
관계:
  - N:1 → Pod
  - N:1 → User
  - 자기 참조 (parent_comment_id)
비고: 
  - 최상위: parent_comment_id = NULL
  - CASCADE DELETE (부모 삭제 시 자식도 삭제)

[TABLE] Chat 실시간 채팅
목적: Pod별 실시간 채팅 메시지 저장
PK: chat_id (BIGINT, AUTO_INCREMENT)
컬럼:
  - chat_id: 채팅 메시지 ID
  - pod_id: Pod 외래키 (INT, NOT NULL)
  - user_id: User 외래키 (INT, NOT NULL)
  - content: 메시지 내용 (TEXT)
  - time: 메시지 시각 (TIMESTAMP)
인덱스:
  - IDX_Chat_pod_time (pod_id, time)
관계:
  - N:1 → Pod
  - N:1 → User
비고: WebSocket 연결 후 저장

[TABLE] Log 로그
목적: 시스템 로그 기록
PK: log_id (BIGINT, AUTO_INCREMENT)
컬럼:
  - log_id: 로그 ID
  - user_id: User 외래키 (INT, NULL)
  - log_code: 로그 코드 (VARCHAR 50)
  - time: 로그 시각 (TIMESTAMP)
  - content: 로그 내용 (TEXT)
인덱스:
  - IDX_Log_time (time)
관계:
  - N:1 → User (ON DELETE SET NULL)
비고: 사용자 삭제 시 로그는 유지

[TABLE] VectorSyncQueue RAG 벡터화 큐
목적: Pod 벡터화 작업 큐 관리
PK: queue_id (BIGINT, AUTO_INCREMENT)
컬럼:
  - queue_id: 큐 ID
  - pod_id: Pod ID (INT, NOT NULL)
  - action_type: 작업 타입 (ENUM: upsert, delete)
  - status: 상태 (ENUM: pending, processing, failed)
  - created_at: 생성 시각 (TIMESTAMP)
  - retry_count: 재시도 횟수 (INT, DEFAULT 0)
인덱스:
  - IDX_VectorSyncQueue_status_created (status, created_at)
관계: 없음 (독립)
비고:
  - RAG Worker가 1초마다 폴링
  - FOR UPDATE SKIP LOCKED (동시성 제어)
  - 성공 시 DELETE, 실패 시 retry_count++

3.4. 데이터 무결성 및 제약조건

[외래키 제약조건]
- 모든 외래키는 ON DELETE CASCADE 또는 SET NULL
- CASCADE: Pod 삭제 시 관련 데이터 자동 삭제
- SET NULL: User 삭제 시 Log는 유지

[UNIQUE 제약조건]
- User-Pod: 중복 참가 방지 (Pod_Member)
- Pod-Category: 중복 연결 방지 (CategoryLink)

[NOT NULL 제약조건]
- 필수 필드: username, event_time, place, title 등

[DEFAULT 값]
- created_at: CURRENT_TIMESTAMP
- status: 'pending'
- retry_count: 0
- amount: 0

[CHECK 제약조건 (애플리케이션 레벨)]
- min_peoples <= max_peoples
- event_time > NOW()
- content 길이 제한

3.5. 인덱스 전략

[성능 최적화]
1. WHERE 절 빈번 사용: event_time, place, status
2. JOIN 빈번 사용: user_id, pod_id, category_id
3. ORDER BY: created_at, time

[복합 인덱스]
- (pod_id, time): Chat 조회 성능 향상
- (status, created_at): VectorSyncQueue 폴링 성능

[UNIQUE 인덱스]
- 중복 방지 + 조회 성능